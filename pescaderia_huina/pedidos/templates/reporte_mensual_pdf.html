{% load humanize %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Reporte Mensual - Pescadería Huina</title>
    <style>
        /* CONFIGURACIÓN DE PÁGINA */
        @page {
            size: letter landscape; 
            margin: 1.5cm;
            @frame footer_frame {
                -pdf-frame-content: footer_content;
                left: 1.5cm; right: 1.5cm; bottom: 1cm; height: 1cm;
            }
        }
        
        /* TIPOGRAFÍA ESTILO HOJA DE CÁLCULO */
        body {
            font-family: 'Calibri', 'Helvetica Neue', Arial, sans-serif;
            font-size: 11px;
            color: #000000;
            line-height: 1.3;
        }

        /* UTILIDADES DE ALINEACIÓN Y FORMATO */
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-bold { font-weight: bold; }

        /* CABECERA (Estilo Título de Reporte) */
        .header-table { width: 100%; margin-bottom: 20px; border-collapse: collapse; }
        .header-table td { padding: 4px; border: none; }
        .report-title { font-size: 22px; font-weight: bold; color: #107C41; margin: 0; text-transform: uppercase; }
        .report-subtitle { font-size: 14px; font-weight: bold; color: #333333; }
        
        /* CAJA DE METADATOS (Como celdas de Excel superiores) */
        .meta-box { border: 1px solid #BFBFBF; background-color: #F3F2F1; padding: 6px; }

        /* TABLAS TIPO EXCEL (Bordes, Grid) */
        .excel-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        .excel-table th, .excel-table td { 
            border: 1px solid #BFBFBF; 
            padding: 6px 8px; 
            vertical-align: middle;
        }
        
        /* ENCABEZADOS DE TABLA (Verde Excel) */
        .excel-table th { 
            background-color: #107C41; 
            color: #FFFFFF; 
            font-size: 11px; 
            text-transform: uppercase;
            font-weight: bold;
        }

        /* TABLA DE RESUMEN (Indicadores) */
        .summary-header { background-color: #E6F2EB !important; color: #107C41 !important; }
        .summary-val { font-size: 14px; font-weight: bold; }

        /* FORMATO CONDICIONAL DE ESTADOS (Estilo celda pintada) */
        .status-cell { font-weight: bold; text-align: center; font-size: 10px; text-transform: uppercase;}
        .bg-green { background-color: #C6EFCE; color: #006100; }
        .bg-amber { background-color: #FFEB9C; color: #9C6500; }
        .bg-red { background-color: #FFC7CE; color: #9C0006; }

        /* FILA DE TOTALES */
        .total-row td {
            background-color: #F3F2F1;
            font-weight: bold;
            font-size: 12px;
            border-top: 2px solid #000000;
            border-bottom: 2px double #000000;
        }

    </style>
</head>
<body>

    <div id="footer_content">
        <table style="width: 100%; border-top: 1px solid #BFBFBF; padding-top: 5px;">
            <tr>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: left; font-family: 'Calibri', sans-serif;">
                    Archivo: Reporte_Mensual_Huina.pdf | Generado por Sistema de Gestión
                </td>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: right; font-family: 'Calibri', sans-serif;">
                    Página <pdf:pagenumber> de <pdf:pagecount>
                </td>
            </tr>
        </table>
    </div>

    <table class="header-table">
        <tr>
            <td style="width: 60%;">
                <h1 class="report-title">PESCADERÍA HUINA</h1>
                <div class="report-subtitle">Reporte Mensual de Pedidos </div>
            </td>
            <td style="width: 40%; vertical-align: bottom;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="text-right text-bold" style="width: 40%; padding-right: 10px;">Mes de Análisis:</td>
                        <td class="text-left meta-box text-bold" style="text-transform: capitalize;">{% now "F" %}</td>
                    </tr>
                    <tr>
                        <td class="text-right text-bold" style="padding-right: 10px;">Fecha de Impresión:</td>
                        <td class="text-left meta-box">{{ fecha_generacion|date:"d/m/Y H:i" }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <table class="excel-table">
        <thead>
            <tr>
                <th class="summary-header text-center" style="width: 25%;">Total de Órdenes</th>
                <th class="summary-header text-center" style="width: 25%;">Órdenes Recibidas</th>
                <th class="summary-header text-center" style="width: 25%;">Órdenes Pendientes</th>
                <th class="summary-header text-center" style="width: 25%;">Órdenes Canceladas</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="text-center summary-val">{{ total_pedidos|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #006100;">{{ ordenes_confirmadas|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #9C6500;">{{ ordenes_pendientes|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #9C0006;">{{ ordenes_canceladas|default:"0" }}</td>
            </tr>
        </tbody>
    </table>

    <table class="excel-table">
        <thead>
            <tr>
                <th class="text-center" style="width: 10%;">ID ORDEN</th>
                <th class="text-center" style="width: 12%;">FECHA</th>
                <th class="text-left" style="width: 30%;">PROVEEDOR</th>
                <th class="text-center" style="width: 15%;">NIT</th>
                <th class="text-center" style="width: 15%;">ESTADO</th>
                <th class="text-right" style="width: 18%;">IMPORTE TOTAL</th>
            </tr>
        </thead>
        <tbody>
            {% for p in pedidos %}
            <tr>
                <td class="text-center">{{ p.id }}</td>
                <td class="text-center">{{ p.fecha|date:"d/m/Y" }}</td>
                <td class="text-left">{{ p.proveedor.nombre_contacto }}</td>
                <td class="text-center">{{ p.proveedor.nit }}</td>
                
                {% if p.estado == 'REC' or p.estado == 'recibido' %} 
                    <td class="status-cell bg-green">Recibido</td>
                {% elif p.estado == 'PEN' or p.estado == 'pendiente' %} 
                    <td class="status-cell bg-amber">Pendiente</td>
                {% else %} 
                    <td class="status-cell bg-red">Cancelado</td>
                {% endif %}
                
                <td class="text-right">
                    $ {{ p.valor_total|default:"0"|floatformat:0|intcomma }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center" style="padding: 30px; color: #555555; font-style: italic;">
                    (No hay datos registrados para mostrar en este rango)
                </td>
            </tr>
            {% endfor %}

            {% if pedidos %}
            <tr class="total-row">
                <td colspan="4" style="border-right: none;"></td>
                <td class="text-right text-bold" style="border-left: none;">TOTAL FACTURADO:</td>
                <td class="text-right text-bold">
                    $ {{ suma_total|default:"0"|floatformat:0|intcomma }}
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>

</body>
</html>