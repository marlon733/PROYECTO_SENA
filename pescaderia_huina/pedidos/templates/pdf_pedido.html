{% load humanize %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pedido #{{ pedido.id }} - Pescadería Huina</title>
    <style>
        /* CONFIGURACIÓN DE PÁGINA (Portrait para factura/pedido) */
        @page {
            size: letter portrait; 
            margin: 1.5cm;
            @frame footer_frame {
                -pdf-frame-content: footer_content;
                left: 1.5cm; right: 1.5cm; bottom: 1cm; height: 1cm;
            }
        }
        
        /* TIPOGRAFÍA ESTILO HOJA DE CÁLCULO */
        body {
            font-family: 'Calibri', 'Helvetica Neue', Arial, sans-serif;
            font-size: 11px;
            color: #000000;
            line-height: 1.3;
        }

        /* UTILIDADES DE ALINEACIÓN Y FORMATO */
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-bold { font-weight: bold; }

        /* CABECERA (Estilo Título de Reporte) */
        .header-table { width: 100%; margin-bottom: 20px; border-collapse: collapse; }
        .header-table td { padding: 4px; border: none; }
        .report-title { font-size: 22px; font-weight: bold; color: #107C41; margin: 0; text-transform: uppercase; }
        .report-subtitle { font-size: 14px; font-weight: bold; color: #333333; }
        
        /* CAJA DE METADATOS (Como celdas de Excel superiores) */
        .meta-box { border: 1px solid #BFBFBF; background-color: #F3F2F1; padding: 6px; }

        /* TABLAS TIPO EXCEL (Bordes, Grid) */
        .excel-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        .excel-table th, .excel-table td { 
            border: 1px solid #BFBFBF; 
            padding: 6px 8px; 
            vertical-align: middle;
        }
        
        /* ENCABEZADOS DE TABLA (Verde Excel) */
        .excel-table th { 
            background-color: #107C41; 
            color: #FFFFFF; 
            font-size: 11px; 
            text-transform: uppercase;
            font-weight: bold;
        }

        /* FORMATO CONDICIONAL DE ESTADOS (Estilo celda pintada) */
        .status-cell { font-weight: bold; text-align: center; font-size: 10px; text-transform: uppercase;}
        .bg-green { background-color: #C6EFCE; color: #006100; }
        .bg-amber { background-color: #FFEB9C; color: #9C6500; }
        .bg-red { background-color: #FFC7CE; color: #9C0006; }

        /* FILA DE TOTALES */
        .total-row td {
            background-color: #F3F2F1;
            font-weight: bold;
            font-size: 12px;
            border-top: 2px solid #000000;
            border-bottom: 2px double #000000;
        }
        
        /* Celdas grises para formularios */
        .form-label {
            background-color: #F3F2F1;
            font-weight: bold;
            text-align: right;
            width: 15%;
        }

    </style>
</head>
<body>

    <div id="footer_content">
        <table style="width: 100%; border-top: 1px solid #BFBFBF; padding-top: 5px;">
            <tr>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: left;">
                    Documento Oficial | Sistema de Gestión Pescadería
                </td>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: right;">
                    Página <pdf:pagenumber> de <pdf:pagecount>
                </td>
            </tr>
        </table>
    </div>

    <table class="header-table">
        <tr>
            <td style="width: 60%;">
                <h1 class="report-title">PESCADERÍA HUINA</h1>
                <div class="report-subtitle">Detalle Oficial de Pedido</div>
            </td>
            <td style="width: 40%; vertical-align: bottom;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="text-right text-bold" style="width: 40%; padding-right: 10px;">N° de Orden:</td>
                        <td class="text-center meta-box text-bold" style="font-size: 14px; color: #107C41;">
                            #{{ pedido.id }}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right text-bold" style="padding-right: 10px;">Fecha de Emisión:</td>
                        <td class="text-center meta-box">{{ pedido.fecha|date:"d/m/Y" }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <table class="excel-table">
        <thead>
            <tr>
                <th colspan="2" class="text-left">DATOS DEL PROVEEDOR</th>
                <th colspan="2" class="text-left">INFORMACIÓN DEL PEDIDO</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="form-label">Razón Social:</td>
                <td class="text-left" style="width: 35%;">{{ pedido.proveedor.nombre_contacto }}</td>
                <td class="form-label">Estado Actual:</td>
                <td class="text-center" style="width: 35%; padding: 0;">
                    {% if pedido.estado == 'REC' or pedido.estado == 'recibido' %} 
                        <div class="status-cell bg-green" style="padding: 6px;">Recibido</div>
                    {% elif pedido.estado == 'PEN' or pedido.estado == 'pendiente' %} 
                        <div class="status-cell bg-amber" style="padding: 6px;">Pendiente</div>
                    {% else %} 
                        <div class="status-cell bg-red" style="padding: 6px;">Cancelado</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td class="form-label">NIT:</td>
                <td class="text-left">{{ pedido.proveedor.nit }}</td>
                <td class="form-label">Impreso el:</td>
                <td class="text-center">{% now "d/m/Y H:i" %}</td>
            </tr>
        </tbody>
    </table>

    <table class="excel-table">
        <thead>
            <tr>
                <th class="text-left" style="width: 40%;">PRODUCTO</th>
                <th class="text-center" style="width: 20%;">CANTIDAD</th>
                <th class="text-center" style="width: 20%;">PRECIO UN.</th>
                <th class="text-right" style="width: 20%;">SUBTOTAL</th>
            </tr>
        </thead>
        <tbody>
            {% for d in detalles %}
            <tr>
                <td class="text-left">{{ d.producto.nombre }}</td>
                <td class="text-center">{{ d.cantidad|floatformat:"-1" }} {{ d.presentacion|title }}</td>
                <td class="text-center">$ {{ d.precio_unitario|floatformat:0|intcomma }}</td>
                <td class="text-right">$ {{ d.subtotal_calculado|floatformat:0|intcomma }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center" style="padding: 30px; color: #555555; font-style: italic;">
                    No hay productos registrados en esta orden.
                </td>
            </tr>
            {% endfor %}

            <tr class="total-row">
                <td colspan="2" style="border-right: none;"></td>
                <td class="text-right text-bold" style="border-left: none;">TOTAL GENERAL:</td>
                <td class="text-right text-bold" style="font-size: 14px; color: #107C41;">
                    $ {{ pedido.valor_total|floatformat:0|intcomma }}
                </td>
            </tr>
        </tbody>
    </table>

</body>
</html>