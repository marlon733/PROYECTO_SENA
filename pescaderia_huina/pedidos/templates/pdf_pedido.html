<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pedido #{{ pedido.id }} - Pescadería Huina</title>
    <style>
        @page {
            size: letter portrait;
            margin: 1.5cm;
        }
        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 11px;
            color: #333333;
        }

        /* Tipografía y alineación */
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-bold { font-weight: bold; }
        .text-blue { color: #0f3976; }

        /* Cajas de Información (Solución al borde cortado) */
        .info-box {
            background-color: #f7f9fc;
            border: 1px solid #d1d5db;
            padding: 10px;
        }
        
        /* Tablas base */
        .pdf-table { width: 100%; }
        
        /* Tabla de Productos */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .items-table th {
            background-color: #0f3976;
            color: #ffffff;
            padding: 8px 5px;
            text-align: left;
            font-size: 11px;
        }
        /* Solución a las líneas divisorias */
        .items-table td {
            padding: 10px 5px;
            border-bottom: 1px solid #cccccc; 
        }
        
        /* Fila del Total */
        .items-table .total-row td {
            border-bottom: none; /* Quitamos la línea del total */
            padding-top: 15px;
            font-size: 13px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <table class="pdf-table" cellspacing="0" cellpadding="0">
        <tr>
            <td width="60%">
                <h1 class="text-blue" style="margin: 0; font-size: 24px; letter-spacing: 1px;">PESCADERÍA HUIÑA</h1>
                <p style="color: #666; font-size: 12px; margin: 2px 0 0 0;">Reporte Oficial de Pedido</p>
            </td>
            <td width="40%" class="text-right" style="vertical-align: bottom;">
                <h2 class="text-blue" style="margin: 0; font-size: 20px;">ORDEN #{{ pedido.id }}</h2>
            </td>
        </tr>
    </table>
    
    <hr style="color: #0f3976; background-color: #0f3976; height: 2px; margin: 15px 0 25px 0; border: none;">

    <table class="pdf-table" cellspacing="0" cellpadding="0">
        <tr>
            <td width="48%" style="vertical-align: top;">
                <div class="info-box">
                    <div class="text-blue text-bold" style="margin-bottom: 8px; text-align: center;">DATOS DEL PROVEEDOR</div>
                    <p style="margin: 0; padding: 3px 0;"><strong>Razón Social:</strong> {{ pedido.proveedor.nombre_contacto }}</p>
                    <p style="margin: 0; padding: 3px 0;"><strong>NIT:</strong> {{ pedido.proveedor.nit }}</p>
                </div>
            </td>
            
            <td width="4%"></td>
            
            <td width="48%" style="vertical-align: top;">
                <div class="info-box">
                    <div class="text-blue text-bold" style="margin-bottom: 8px; text-align: center;">DETALLES DEL PEDIDO</div>
                    <p style="margin: 0; padding: 3px 0; text-align: right;"><strong>Fecha de emisión:</strong> {{ pedido.fecha|date:"d/m/Y" }}</p>
                    <p style="margin: 0; padding: 3px 0; text-align: right;"><strong>Estado:</strong> 
                        {% if pedido.estado == 'REC' %} RECIBIDO
                        {% elif pedido.estado == 'PEN' %} PENDIENTE
                        {% else %} CANCELADO {% endif %}
                    </p>
                </div>
            </td>
        </tr>
    </table>

    <table class="items-table" cellspacing="0" cellpadding="0">
        <thead>
            <tr>
                <th width="40%">PRODUCTO</th>
                <th width="20%" class="text-center">CANTIDAD</th>
                <th width="20%" class="text-center">PRECIO UN.</th>
                <th width="20%" class="text-right">SUBTOTAL</th>
            </tr>
        </thead>
        <tbody>
            {% for d in detalles %}
            <tr>
                <td>{{ d.producto.nombre }}</td>
                <td class="text-center">{{ d.cantidad|floatformat:"-1" }} {{ d.presentacion|title }}</td>
                <td class="text-center">${{ d.precio_unitario|floatformat:0 }}</td>
                <td class="text-right">${{ d.subtotal_calculado|floatformat:0 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center" style="padding: 20px; color: #666;">No hay productos registrados.</td>
            </tr>
            {% endfor %}
            
            <tr class="total-row">
                <td colspan="3" class="text-right">TOTAL GENERAL:</td>
                <td class="text-right text-blue" style="font-size: 15px;">${{ pedido.valor_total|floatformat:0 }}</td>
            </tr>
        </tbody>
    </table>

</body>
</html>