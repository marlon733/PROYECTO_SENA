{% load humanize %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Reporte Mensual - Ventas Huina</title>
    <style>
        @page {
            size: letter landscape; 
            margin: 1.5cm;
            @frame footer_frame {
                -pdf-frame-content: footer_content;
                left: 1.5cm; right: 1.5cm; bottom: 1cm; height: 1cm;
            }
        }
        
        body {
            font-family: 'Calibri', 'Helvetica Neue', Arial, sans-serif;
            font-size: 11px;
            color: #000000;
            line-height: 1.3;
        }

        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-bold { font-weight: bold; }

        .header-table { width: 100%; margin-bottom: 20px; border-collapse: collapse; }
        .header-table td { padding: 4px; border: none; }
        .report-title { font-size: 22px; font-weight: bold; color: #0A3D62; margin: 0; text-transform: uppercase; }
        .report-subtitle { font-size: 14px; font-weight: bold; color: #333333; }
        
        .meta-box { border: 1px solid #BFBFBF; background-color: #F3F2F1; padding: 6px; }

        .excel-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        .excel-table th, .excel-table td { 
            border: 1px solid #BFBFBF; 
            padding: 6px 8px; 
            vertical-align: middle;
        }
        .excel-table th { 
            background-color: #0A3D62; 
            color: #FFFFFF; 
            font-size: 11px; 
            text-transform: uppercase;
            font-weight: bold;
        }

        .summary-header { background-color: #D6E4F0 !important; color: #0A3D62 !important; }
        .summary-val { font-size: 14px; font-weight: bold; }

        .status-cell { font-weight: bold; text-align: center; font-size: 10px; text-transform: uppercase; }
        .bg-green { background-color: #C6EFCE; color: #006100; }
        .bg-amber { background-color: #FFEB9C; color: #9C6500; }
        .bg-red { background-color: #FFC7CE; color: #9C0006; }

        .badge-empacado { background-color: #D1ECF1; color: #0C5460; font-weight: bold; }
        .badge-libra   { background-color: #FFF3CD; color: #856404; font-weight: bold; }
        .badge-bandeja { background-color: #E2E3E5; color: #383D41; font-weight: bold; }

        .total-row td {
            background-color: #F3F2F1;
            font-weight: bold;
            font-size: 12px;
            border-top: 2px solid #000000;
            border-bottom: 2px double #000000;
        }
    </style>
</head>
<body>

    <div id="footer_content">
        <table style="width: 100%; border-top: 1px solid #BFBFBF; padding-top: 5px;">
            <tr>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: left; font-family: 'Calibri', sans-serif;">
                    Archivo: Reporte_Ventas_Huina.pdf | Generado por Sistema de Gestión
                </td>
                <td style="width: 50%; font-size: 9px; color: #555555; text-align: right; font-family: 'Calibri', sans-serif;">
                    Página <pdf:pagenumber> de <pdf:pagecount>
                </td>
            </tr>
        </table>
    </div>

    <!-- CABECERA -->
    <table class="header-table">
        <tr>
            <td style="width: 60%;">
                <h1 class="report-title">PESCADERÍA HUINA</h1>
                <div class="report-subtitle">Reporte Mensual de Ventas</div>
            </td>
            <td style="width: 40%; vertical-align: bottom;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="text-right text-bold" style="width: 40%; padding-right: 10px;">Mes de Análisis:</td>
                        <td class="text-left meta-box text-bold" style="text-transform: capitalize;">{{ mes_actual }}</td>
                    </tr>
                    <tr>
                        <td class="text-right text-bold" style="padding-right: 10px;">Fecha de Impresión:</td>
                        <td class="text-left meta-box">{{ fecha_reporte|date:"d/m/Y H:i" }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <!-- RESUMEN DE INDICADORES -->
    <table class="excel-table">
        <thead>
            <tr>
                <th class="summary-header text-center" style="width: 25%;">Total de Ventas</th>
                <th class="summary-header text-center" style="width: 25%;">Ventas Completadas</th>
                <th class="summary-header text-center" style="width: 25%;">Ventas Pendientes</th>
                <th class="summary-header text-center" style="width: 25%;">Ventas Canceladas</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="text-center summary-val">{{ total_ventas|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #006100;">{{ ventas_completadas|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #9C6500;">{{ ventas_pendientes|default:"0" }}</td>
                <td class="text-center summary-val" style="color: #9C0006;">{{ ventas_canceladas|default:"0" }}</td>
            </tr>
        </tbody>
    </table>

    <!-- TABLA DETALLE -->
    <table class="excel-table">
        <thead>
            <tr>
                <th class="text-center" style="width: 6%;">ID</th>
                <th class="text-center" style="width: 10%;">FECHA</th>
                <th class="text-left"  style="width: 18%;">CLIENTE</th>
                <th class="text-center" style="width: 10%;">DOCUMENTO</th>
                <th class="text-left"  style="width: 18%;">PRODUCTO</th>
                <th class="text-center" style="width: 12%;">PRESENTACIÓN</th>
                <th class="text-right" style="width: 7%;">CANTIDAD</th>
                <th class="text-right" style="width: 9%;">PRECIO UNIT.</th>
                <th class="text-center" style="width: 6%;">ESTADO</th>
                <th class="text-right" style="width: 9%;">TOTAL</th>
            </tr>
        </thead>
        <tbody>
            {% for venta in ventas %}
            <tr>
                <td class="text-center">{{ venta.id }}</td>
                <td class="text-center">{{ venta.fecha_venta|date:"d/m/Y" }}</td>
                <td class="text-left">{{ venta.nombre_cliente|default:"—" }}</td>
                <td class="text-center">{{ venta.documento_cliente|default:"—" }}</td>
                <td class="text-left">{{ venta.producto.nombre|default:"—" }}</td>
                <td class="text-center">
                    {% if venta.tipo_presentacion == 'EMPACADO_VACIO' %}
                        <span class="badge-empacado">Empacado al Vacío</span>
                    {% elif venta.tipo_presentacion == 'POR_LIBRA' %}
                        <span class="badge-libra">Por Libra</span>
                    {% else %}
                        <span class="badge-bandeja">Bandeja</span>
                    {% endif %}
                </td>
                <td class="text-right">
                    {{ venta.cantidad|floatformat:"-1" }}
                    {% if venta.tipo_presentacion == 'POR_LIBRA' %}lb{% else %}und{% endif %}
                </td>
                <td class="text-right">$ {{ venta.precio_unitario|default:"0"|floatformat:0|intcomma }}</td>
                {% if venta.estado == 'COMPLETADA' %}
                    <td class="status-cell bg-green">Completada</td>
                {% elif venta.estado == 'PENDIENTE' %}
                    <td class="status-cell bg-amber">Pendiente</td>
                {% else %}
                    <td class="status-cell bg-red">Cancelada</td>
                {% endif %}
                <td class="text-right">$ {{ venta.total|default:"0"|floatformat:0|intcomma }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10" class="text-center" style="padding: 30px; color: #555555; font-style: italic;">
                    (No hay datos registrados para mostrar en este rango)
                </td>
            </tr>
            {% endfor %}

            {% if ventas %}
            <tr class="total-row">
                <td colspan="8" style="border-right: none;"></td>
                <td class="text-right text-bold" style="border-left: none;">TOTAL INGRESOS:</td>
                <td class="text-right text-bold">$ {{ total_ingresos|default:"0"|floatformat:0|intcomma }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

</body>
</html>